# Descrição da configuração de deploy
name: Pipeline para Deploy da aplicação no AWS

# Definir o evento que irá gerar a publicação do projeto
on:
   push: # realizar um push no github
     branches: # branch principal
        - main
   pull_request: # realizar um pull request
     branches: # branch principal
        - main

# Definir as tarefas que serão feitas após o push
jobs:
    build: # compilação do projeto
       name: Compilação do projeto Spring Boot
       runs-on: ubuntu-latest # Servidor linux
       steps:
          # Checkout do código
          - name: Checkout do código
            uses: actions/checkout@v2

          # Setup para compilar o projeto
          - name: Configuração do JDK 21
            uses: actions/setup-java@v2
            with:
                java-version: "21"
                distribution: "temurin"
          
          # Build do projeto usando o maven
          - name: Compilar o projeto com o Maven
            run: mvn clean package -DskipTests

          # Pegar os arquivos compilados do diretório /target
          - name: Pegar os arquivos da pasta target
            run: ls -la target

          # Upload dos arquivos
          - name: Gerando o arquivo JAR compilado do projeto
            uses: actions/upload-artifact@v3
            with:
                name: jar-file
                path: target/*.jar

    test: # execução dos testes
       name: Executar os testes do projeto
       runs-on: ubuntu-latest
       needs: build # depende da execução bem-sucedida do job de build
       steps:
          # Checkout do código
          - name: Checkout do código
            uses: actions/checkout@v2

          # Setup para o Maven
          - name: Configuração do JDK 21
            uses: actions/setup-java@v2
            with:
                java-version: "21"
                distribution: "temurin"

          # Executar os testes do projeto
          - name: Executar os testes do Maven
            run: mvn test
