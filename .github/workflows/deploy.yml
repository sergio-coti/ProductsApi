name: Pipeline para Deploy da aplicação no AWS

on:
   push:
     branches:
        - main
   pull_request:
     branches:
        - main

jobs:
    build:
       name: Compilação do projeto Spring Boot
       runs-on: ubuntu-latest
       steps:
          - name: Checkout do código
            uses: actions/checkout@v2

          - name: Configuração do JDK 21
            uses: actions/setup-java@v2
            with:
                java-version: "21"
                distribution: "temurin"

          - name: Compilar o projeto com o Maven
            run: mvn clean package -DskipTests

          - name: Pegar os arquivos da pasta target
            run: ls -la target

          - name: Gerando o arquivo JAR compilado do projeto
            uses: actions/upload-artifact@v3
            with:
                name: jar-file
                path: target/*.jar

    test:
       name: Executar os testes do projeto
       runs-on: ubuntu-latest
       needs: build
       steps:
          - name: Checkout do código
            uses: actions/checkout@v2

          - name: Configuração do JDK 21
            uses: actions/setup-java@v2
            with:
                java-version: "21"
                distribution: "temurin"

          - name: Executar os testes do Maven
            run: mvn test

          # Gerar relatório HTML de testes
          - name: Gerar relatório de testes
            run: mvn surefire-report:report

          # Fazer o upload do relatório gerado para o GitHub
          - name: Upload do relatório de testes
            uses: actions/upload-artifact@v3
            with:
                name: test-reports
                path: target/site/surefire-report.html
